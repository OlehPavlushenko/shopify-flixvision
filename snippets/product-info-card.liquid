{% liquid
    assign show_vendor = settings.show_vendor
    assign show_rating = settings.show_rating
    assign add_btn = settings.enable_add_btn
    assign btn = settings.btn
    assign variant_type = settings.variant
    assign notify_me = settings.notify_me

    assign price_variant = settings.price_variant
    assign date_timer = product.metafields.custom.countdown_timer
%}

<div class="card-product__content">
    {% if date_timer %}
        <div class="card-product__badge card-product__badge--offer">
            {{ 'products.product.offer' | t }}
        </div>
        <countdown-container data-date="{{ date_timer }}">
            <div id="countdown-{{ product.id }}" class="countdown-box card-product__countdown">
                <div class="days-container">
                    <div class="days"></div>
                    <div class="days-label">{{ 'header.days' | t }}</div>
                </div>

                <div class="hours-container">
                    <div class="hours"></div>
                    <div class="hours-label">{{ 'header.hours' | t }}</div>
                </div>

                <div class="minutes-container">
                    <div class="minutes"></div>
                    <div class="minutes-label">{{ 'header.minutes' | t }}</div>
                </div>

                <div class="seconds-container">
                    <div class="seconds"></div>
                    <div class="seconds-label">{{ 'header.seconds' | t }}</div>
                </div>
            </div>
        </countdown-container>
    {% endif %}
    {% if show_vendor %}
        <div class="card-product__row">
            <span class="card-product__vendor">{{ product.vendor }}</span>
            {%- for var in product.variants -%}
                {%- assign varQ = var.inventory_quantity -%}
            {%- endfor -%}
            <div class="card-product__stock">
                <span
                    class="card-product__icon card-product__stock--{% if sold_out %}nostock {% elsif varQ < 10 and sold_out == false %}lowstock{% else %}normalstock{% endif %} js-card-product-stock"
                ></span>
                <span class="stock-level">{{ 'products.product.stock_level' | t }}</span>
            </div>
        </div>
    {% endif %}
    <h5 class="card-product__title js-card-product-title">
        <a href="{{ product.url | within: collection }}">
            {{ product.title | truncate: 60 | escape }}
        </a>
    </h5>
    <div class="card-product__desc" itemprop="name">{{ product.description | strip_html | truncate: 80 }}</div>
    {% render 'price',
        product: product,
        price_class: 'card-product__price js-card-product-price',
        use_variant: use_variant
    %}

    {% if add_btn %}
        {% if btn == 'quick' %}
            {% render 'form-collection',
                product: product,
                variant_type: variant_type,
                show_quantity: true,
                notify_me: notify_me
            %}
        {% else %}
            {% if product.available %}
                <div class="card-product__btns">
                    <a
                        class="button button--secondary card-product__button-cart"
                        href="{{ product.url | within: collection }}"
                    >
                        {{- 'products.product.details' | t -}}
                    </a>
                    {% render 'compare-wishlist-btns', product: product %}
                </div>
            {% else %}
                {% if notify_me %}
                    <details-open-notify>
                        <div class="card-product__btns">
                            <a
                                class="button button--primary card-product__button-notify js-summary"
                                href="#notify"
                                role="button"
                            >
                                {{ 'products.product.ask_btn' | t }}
                            </a>
                            {% render 'compare-wishlist-btns', product: product %}
                        </div>
                        <div class="card-product__notify-form js-details">
                            {% render 'notify-form', product: product %}
                        </div>
                        <div class="card-product__overlay">
                            <span class="visually-hidden">{{ 'accessibility.close' | t }}</span>
                        </div>
                    </details-open-notify>
                {% else %}
                    <div class="card-product__btns">
                        <button
                            type="button"
                            id="SoldOutText-{{ product.id }}"
                            class="button--secondary card-product__button-sold"
                            disabled=""
                        >
                            <span id="SoldOutText">{{ 'products.product.sold_out' | t }}</span>
                        </button>
                        {% render 'compare-wishlist-btns', product: product %}
                    </div>
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}
    {%- if show_rating and product.metafields.reviews.rating.value != blank -%}
        {% render 'card-rating', product: product %}
    {%- endif -%}
</div>
