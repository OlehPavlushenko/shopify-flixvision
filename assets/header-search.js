class HeaderSearch extends HTMLElement{constructor(){super(),this.isOpen=!1,this.route="/search/suggest",this.cachedResults={},this.input=this.querySelector('.search_wrapper input[type="search"]'),this.headerSearchResults=this.querySelector(".results"),this.headerSearchSuggestions=this.querySelector(".suggestions"),this.headerSearchFocusable=this.querySelector(".search-modal__focusable"),this.suggestionButtons=this.querySelectorAll(".search-modal__suggested button"),this.modal=this.closest(".search-modal"),this.setupEventListeners()}setupEventListeners(){this.querySelector("form.search").addEventListener("submit",this.onFormSubmit.bind(this)),this.input.addEventListener("input",this.debounce((e=>{this.onChange(e)}),300).bind(this)),this.input.addEventListener("focus",this.onFocus.bind(this)),this.suggestionButtons.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),e.dataset.term.length&&(this.input.value=e.dataset.term,this.updateTermButtonState(e),this.onChange(t))}).bind(this))})),document.addEventListener("details-closed",this.close.bind(this,!0))}disconnectedCallback(){document.removeEventListener("details-closed",this.close)}getQuery(){return this.input.value.trim()}onChange(){const e=this.getQuery();e.length?e.length<3?this.close():(this.resetSuggestions(),this.getSearchResults(e)):this.close(!0)}resetSuggestions(){this.suggestionButtons.forEach((e=>{this.getQuery()!==e.dataset.term&&e.removeAttribute("disabled")}))}onFormSubmit(e){this.getQuery().length||e.preventDefault()}onFocus(){const e=this.getQuery();e.length&&(e.length<3||("true"===this.getAttribute("results")?this.open():this.getSearchResults(e)))}updateTermButtonState(e){this.getQuery()===e.dataset.term&&e.setAttribute("disabled",!0)}getSearchResults(e){const t=e.replace(" ","-").toLowerCase();this.setLiveRegionLoadingState(),this.cachedResults[t]?this.renderSearchResults(this.cachedResults[t]):fetch(`${this.route}?q=${encodeURIComponent(e)}&${encodeURIComponent("resources[type]")}=product,article,collection,page&${encodeURIComponent("resources[options][fields]")}=body,product_type,tag,title,variants.barcode,variants.sku,variants.title,vendor,author&section_id=header-search`).then((e=>{if(!e.ok){var t=new Error(e.status);throw this.close(),t}return e.text()})).then((e=>{const s=(new DOMParser).parseFromString(e,"text/html").querySelector("#shopify-section-header-search").innerHTML;this.cachedResults[t]=s,this.renderSearchResults(s);const i=(new DOMParser).parseFromString(e,"text/html");console.log(i)})).catch((e=>{throw this.close(),e}))}setLiveRegionLoadingState(){this.setAttribute("loading",!0)}renderSearchResults(e){this.headerSearchResults.innerHTML=e,this.setAttribute("results",!0),this.setLiveRegionResults(),this.open()}setLiveRegionResults(){this.removeAttribute("loading")}open(){this.setAttribute("open",!0),this.input.setAttribute("aria-expanded",!0),this.isOpen=!0,this.modal.classList.add("search-modal__full"),trapFocus(this.headerSearchFocusable,this.input)}close(e=!1){e&&(this.input.value="",this.cachedResults={},this.removeAttribute("results"),this.resetSuggestions()),this.input.setAttribute("aria-activedescendant",""),this.removeAttribute("open"),this.input.setAttribute("aria-expanded",!1),this.isOpen=!1,this.modal.classList.remove("search-modal__full")}debounce=(e,t)=>{let s;return(...i)=>{clearTimeout(s),s=setTimeout((()=>e.apply(this,i)),t)}}}customElements.define("header-search",HeaderSearch);